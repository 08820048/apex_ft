<template>
  <div class="min-h-screen py-8 px-4 sm:px-6 lg:px-8">
    <div class="max-w-7xl mx-auto">
      <!-- é¡µé¢æ ‡é¢˜ -->
      <div class="text-center mb-12">
        <h1 class="text-4xl font-bold text-gray-900 dark:text-white mb-4">
          å‹æƒ…é“¾æ¥
        </h1>
        <p class="text-xl text-gray-600 dark:text-white/80">
          ä¸ä¼˜ç§€çš„æœ‹å‹ä»¬ä¸€èµ·æˆé•¿
        </p>
      </div>

      <!-- æœ¬ç«™å‹é“¾ä¿¡æ¯ -->
      <div
        class="glass-effect rounded-2xl p-6 mb-8 border border-blue-200 dark:border-blue-800"
      >
        <h2
          class="text-xl font-bold text-gray-900 dark:text-white mb-4 flex items-center"
        >
          <span class="w-2 h-2 bg-blue-500 rounded-full mr-3"></span>
          æœ¬ç«™å‹é“¾ä¿¡æ¯
        </h2>
        <p class="text-gray-600 dark:text-gray-300 text-sm mb-4">
          å¦‚æœæ‚¨æƒ³æ·»åŠ æœ¬ç«™åˆ°æ‚¨çš„å‹é“¾ä¸­ï¼Œè¯·å¤åˆ¶ä»¥ä¸‹ä¿¡æ¯ï¼š
        </p>
        <div class="bg-gray-50 dark:bg-gray-800 rounded-xl p-4 space-y-3">
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
              <label
                class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"
                >åšå®¢åç§°</label
              >
              <div class="flex items-center">
                <input
                  type="text"
                  value="Apex-å…«å°ºå¦–å‰‘"
                  readonly
                  class="flex-1 px-3 py-2 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg text-gray-900 dark:text-white text-sm"
                />
                <button
                  @click="copyToClipboard('Apex-å…«å°ºå¦–å‰‘')"
                  class="ml-2 px-3 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-lg text-sm transition-colors"
                  title="å¤åˆ¶"
                >
                  ğŸ“‹
                </button>
              </div>
            </div>
            <div>
              <label
                class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"
                >åšå®¢åœ°å€</label
              >
              <div class="flex items-center">
                <input
                  type="text"
                  value="https://www.ilikexff.cn/"
                  readonly
                  class="flex-1 px-3 py-2 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg text-gray-900 dark:text-white text-sm"
                />
                <button
                  @click="copyToClipboard('https://www.ilikexff.cn/')"
                  class="ml-2 px-3 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-lg text-sm transition-colors"
                  title="å¤åˆ¶"
                >
                  ğŸ“‹
                </button>
              </div>
            </div>
            <div>
              <label
                class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"
                >åšå®¢Logo</label
              >
              <div class="flex items-center">
                <input
                  type="text"
                  value="https://images.waer.ltd/notes/202508151240669.jpg"
                  readonly
                  class="flex-1 px-3 py-2 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg text-gray-900 dark:text-white text-sm"
                />
                <button
                  @click="
                    copyToClipboard(
                      'https://images.waer.ltd/notes/202508151240669.jpg'
                    )
                  "
                  class="ml-2 px-3 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-lg text-sm transition-colors"
                  title="å¤åˆ¶"
                >
                  ğŸ“‹
                </button>
              </div>
            </div>
            <div>
              <label
                class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"
                >åšå®¢æè¿°</label
              >
              <div class="flex items-center">
                <input
                  type="text"
                  value="ä¸€ä¸ªçˆ±ç©é©¬è¶…çš„æ¸¸æˆç¨‹åºå‘˜ã€‚"
                  readonly
                  class="flex-1 px-3 py-2 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg text-gray-900 dark:text-white text-sm"
                />
                <button
                  @click="copyToClipboard('ä¸€ä¸ªçˆ±ç©é©¬è¶…çš„æ¸¸æˆç¨‹åºå‘˜ã€‚')"
                  class="ml-2 px-3 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-lg text-sm transition-colors"
                  title="å¤åˆ¶"
                >
                  ğŸ“‹
                </button>
              </div>
            </div>
          </div>
          <div
            class="flex items-center justify-between pt-3 border-t border-gray-200 dark:border-gray-600"
          >
            <div class="flex items-center">
              <img
                src="https://images.waer.ltd/notes/202508151240669.jpg"
                alt="Apex-å…«å°ºå¦–å‰‘"
                class="w-8 h-8 rounded-full mr-2"
              />
              <span class="text-sm text-gray-600 dark:text-gray-400"
                >é¢„è§ˆæ•ˆæœ</span
              >
            </div>
            <button
              @click="copyAllInfo"
              class="px-4 py-2 bg-green-500 hover:bg-green-600 text-white rounded-lg text-sm transition-colors"
            >
              ğŸ“‹ å¤åˆ¶å…¨éƒ¨ä¿¡æ¯
            </button>
          </div>
        </div>
      </div>

      <!-- å‹é“¾ç”³è¯·è¯´æ˜ -->
      <div class="glass-effect rounded-2xl p-6 mb-8">
        <h2 class="text-xl font-bold text-gray-900 dark:text-white mb-4">
          å‹é“¾ç”³è¯·
        </h2>
        <div class="text-gray-600 dark:text-gray-300 space-y-2">
          <p>æ¬¢è¿ä¸æˆ‘äº¤æ¢å‹æƒ…é“¾æ¥ï¼ç”³è¯·å‰è¯·ç¡®ä¿ï¼š</p>
          <ul class="list-disc list-inside space-y-1 ml-4">
            <li>ç½‘ç«™å†…å®¹ç§¯æå‘ä¸Šï¼Œæ— è¿æ³•è¿è§„å†…å®¹</li>
            <li>ç½‘ç«™èƒ½å¤Ÿæ­£å¸¸è®¿é—®ï¼Œæ›´æ–°é¢‘ç‡è¾ƒé«˜</li>
            <li>ä¼˜å…ˆè€ƒè™‘æŠ€æœ¯ç±»ã€å­¦ä¹ ç±»åšå®¢</li>
          </ul>
          <p class="mt-4">
            ç”³è¯·æ–¹å¼ï¼šè¯·å‘é€é‚®ä»¶è‡³
            <a
              href="mailto:ilikexff@gmail.com"
              class="text-blue-600 hover:text-blue-800"
              >ilikexff@gmail.com</a
            >
            ï¼ŒåŒ…å«ç½‘ç«™åç§°ã€ç½‘ç«™åœ°å€ã€ç½‘ç«™æè¿°å’Œç«™é•¿ä¿¡æ¯ã€‚
          </p>
        </div>
      </div>

      <!-- å‹é“¾åˆ—è¡¨ -->
      <div>
        <h2 class="text-2xl font-bold text-gray-900 dark:text-white mb-6">
          å‹ç«™æ¨è
        </h2>

        <!-- åŠ è½½çŠ¶æ€ -->
        <div
          v-if="loading"
          class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6"
        >
          <div
            v-for="i in 8"
            :key="i"
            class="glass-effect rounded-2xl p-6 animate-pulse"
          >
            <div class="flex items-center mb-4">
              <div class="w-12 h-12 bg-gray-300 rounded-full mr-4"></div>
              <div class="flex-1">
                <div class="h-5 bg-gray-300 rounded mb-2"></div>
                <div class="h-4 bg-gray-300 rounded w-2/3"></div>
              </div>
            </div>
            <div class="h-4 bg-gray-300 rounded mb-2"></div>
            <div class="h-4 bg-gray-300 rounded w-3/4"></div>
          </div>
        </div>

        <!-- å‹é“¾ç½‘æ ¼ -->
        <div
          v-else-if="friendLinks.length > 0"
          class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6"
        >
          <a
            v-for="link in friendLinks"
            :key="link.id"
            :href="link.url"
            target="_blank"
            rel="noopener noreferrer"
            class="glass-effect rounded-2xl p-6 card-hover group block"
          >
            <div class="flex items-center mb-4">
              <div class="w-12 h-12 flex-shrink-0 mr-4">
                <img
                  v-if="link.avatar"
                  :src="link.avatar"
                  :alt="link.name"
                  class="w-full h-full object-cover rounded-full"
                  @error="handleImageError"
                />
                <div
                  v-else
                  class="w-full h-full bg-blue-600 rounded-full flex items-center justify-center"
                >
                  <span class="text-white font-bold text-lg">
                    {{ link.name.charAt(0).toUpperCase() }}
                  </span>
                </div>
              </div>
              <div class="flex-1 min-w-0">
                <h3
                  class="text-lg font-bold text-gray-900 group-hover:text-blue-600 transition-colors truncate"
                >
                  {{ link.name }}
                </h3>
                <p class="text-sm text-gray-500 truncate">
                  {{ getDomain(link.url) }}
                </p>
              </div>
            </div>

            <p class="text-gray-600 text-sm line-clamp-3 mb-4">
              {{ link.description || "æš‚æ— æè¿°" }}
            </p>

            <div
              class="flex items-center justify-between text-xs text-gray-500"
            >
              <span>{{ formatDate(link.createdAt) }}</span>
              <div class="flex items-center">
                <ExternalLinkIcon class="w-3 h-3 mr-1" />
                <span>è®¿é—®</span>
              </div>
            </div>
          </a>
        </div>

        <!-- ç©ºçŠ¶æ€ -->
        <div v-else class="glass-effect rounded-2xl p-12 text-center">
          <div class="text-gray-400 dark:text-gray-500 mb-4">
            <LinkIcon class="w-16 h-16 mx-auto" />
          </div>
          <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-2">
            æš‚æ— å‹é“¾
          </h3>
          <p class="text-gray-600 dark:text-gray-300">
            è¿˜æ²¡æœ‰æ·»åŠ ä»»ä½•å‹æƒ…é“¾æ¥ï¼Œæ¬¢è¿ç”³è¯·äº¤æ¢å‹é“¾ã€‚
          </p>
        </div>
      </div>

      <!-- å‹é“¾ç»Ÿè®¡ -->
      <div v-if="friendLinks.length > 0" class="mt-8 text-center">
        <p class="text-gray-600 dark:text-white/80">
          å…±æœ‰
          <span class="font-bold text-gray-900 dark:text-white">{{
            friendLinks.length
          }}</span>
          ä¸ªå‹ç«™
        </p>
      </div>
    </div>
  </div>
</template>

<script setup>
import { ref, onMounted } from "vue";
import { friendLinkApi } from "../api";

// å›¾æ ‡ç»„ä»¶
const ExternalLinkIcon = {
  template:
    '<svg viewBox="0 0 24 24" fill="currentColor"><path d="M19 19H5V5h7V3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.11 0 2-.9 2-2v-7h-2v7zM14 3v2h3.59l-9.83 9.83 1.41 1.41L19 6.41V10h2V3h-7z"/></svg>',
};
const LinkIcon = {
  template:
    '<svg viewBox="0 0 24 24" fill="currentColor"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z"/></svg>',
};

// å“åº”å¼æ•°æ®
const friendLinks = ref([]);
const loading = ref(false);

// æ ¼å¼åŒ–æ—¥æœŸ
const formatDate = (dateString) => {
  if (!dateString) return "";
  const date = new Date(dateString);
  return date.toLocaleDateString("zh-CN", {
    year: "numeric",
    month: "short",
    day: "numeric",
  });
};

// è·å–åŸŸå
const getDomain = (url) => {
  try {
    const domain = new URL(url).hostname;
    return domain.replace("www.", "");
  } catch {
    return url;
  }
};

// å¤åˆ¶åˆ°å‰ªè´´æ¿
const copyToClipboard = async (text) => {
  try {
    await navigator.clipboard.writeText(text);
    // è¿™é‡Œå¯ä»¥æ·»åŠ æˆåŠŸæç¤º
    console.log("å¤åˆ¶æˆåŠŸ:", text);
  } catch (error) {
    console.error("å¤åˆ¶å¤±è´¥:", error);
    // é™çº§æ–¹æ¡ˆ
    const textArea = document.createElement("textarea");
    textArea.value = text;
    document.body.appendChild(textArea);
    textArea.select();
    document.execCommand("copy");
    document.body.removeChild(textArea);
  }
};

// å¤åˆ¶å…¨éƒ¨ä¿¡æ¯
const copyAllInfo = async () => {
  const allInfo = `åšå®¢åç§°ï¼šApex-å…«å°ºå¦–å‰‘
åšå®¢åœ°å€ï¼šhttps://www.ilikexff.cn/
åšå®¢Logoï¼šhttps://images.waer.ltd/notes/202508151240669.jpg
åšå®¢æè¿°ï¼šä¸€ä¸ªçˆ±ç©é©¬è¶…çš„æ¸¸æˆç¨‹åºå‘˜ã€‚`;

  await copyToClipboard(allInfo);
};

// å¤„ç†å›¾ç‰‡åŠ è½½é”™è¯¯
const handleImageError = (event) => {
  event.target.style.display = "none";
  const parent = event.target.parentElement;
  if (parent) {
    const fallback = document.createElement("div");
    fallback.className =
      "w-full h-full bg-blue-600 rounded-full flex items-center justify-center";
    fallback.innerHTML = `<span class="text-white font-bold text-lg">${event.target.alt
      .charAt(0)
      .toUpperCase()}</span>`;
    parent.appendChild(fallback);
  }
};

// åŠ è½½å‹é“¾åˆ—è¡¨
const loadFriendLinks = async () => {
  try {
    loading.value = true;
    const data = await friendLinkApi.getList();
    // åªæ˜¾ç¤ºæ¿€æ´»çš„å‹é“¾
    friendLinks.value = (data || []).filter((link) => link.isActive);
  } catch (error) {
    console.error("åŠ è½½å‹é“¾å¤±è´¥:", error);
    friendLinks.value = [];
  } finally {
    loading.value = false;
  }
};

// ç»„ä»¶æŒ‚è½½æ—¶åŠ è½½æ•°æ®
onMounted(loadFriendLinks);
</script>

<style scoped>
.line-clamp-3 {
  display: -webkit-box;
  -webkit-line-clamp: 3;
  -webkit-box-orient: vertical;
  overflow: hidden;
}
</style>
